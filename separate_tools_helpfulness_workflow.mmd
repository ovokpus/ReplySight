graph TD
    START([🚀 Start]) --> agent[🧠 Smart Study Buddy Agent]
    
    agent --> decision{🤔 3 Critical Decisions}
    
    %% Decision 1: Specific Tool Routing
    decision -->|"📚 Decision 1a:<br/>Need ArXiv research?"| arxiv[📖 ArXiv Tool Node<br/>Academic Research]
    decision -->|"📚 Decision 1b:<br/>Need Tavily examples?"| tavily[🌐 Tavily Tool Node<br/>Best Practices]
    
    %% Decision 2: Conversation Length Check
    decision -->|"💬 Decision 2:<br/>More than 10 messages?"| END1([🛑 End - Too Much Chatting])
    
    %% Decision 3: Helpfulness Assessment
    decision -->|"⭐ Decision 3:<br/>Is response helpful?"| helpful{🎯 Helpfulness Check<br/>GPT-4o-mini Grades Response}
    decision -->|"✍️ Ready to compose?"| compose[📝 Response Composer<br/>Synthesize with Citations]
    
    %% Helpfulness evaluation paths
    helpful -->|"✅ Score ≥ 0.7<br/>Excellent!"| END2([🎉 End - Success])
    helpful -->|"❌ Score < 0.7<br/>Needs improvement"| compose
    
    %% Tool processing flows
    arxiv --> extract_arxiv[📊 Extract ArXiv<br/>Process Research Data]
    tavily --> extract_tavily[📊 Extract Tavily<br/>Process Examples]
    
    %% Back to agent for next decision
    extract_arxiv --> agent
    extract_tavily --> agent
    
    %% Final composition
    compose --> END3([✨ End - Response Ready])
    
    %% Feedback loop
    decision -->|"🔄 Default:<br/>Continue thinking"| agent
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579B,stroke-width:3px
    classDef agent fill:#f3e5f5,stroke:#4A148C,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#E65100,stroke-width:2px
    classDef tools fill:#e8f5e8,stroke:#1B5E20,stroke-width:2px
    classDef process fill:#fce4ec,stroke:#880E4F,stroke-width:2px
    classDef compose fill:#f1f8e9,stroke:#33691E,stroke-width:2px
    
    class START,END1,END2,END3 startEnd
    class agent agent
    class decision,helpful decision
    class arxiv,tavily tools
    class extract_arxiv,extract_tavily process
    class compose compose 